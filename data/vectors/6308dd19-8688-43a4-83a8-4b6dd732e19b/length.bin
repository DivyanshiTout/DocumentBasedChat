                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Ç|†||° |†|	|° q4ntÉ †|°}|S )Nrv   r  r]  )rù  r6   r≤   rÖ   rô   r∏   r  r  r¥   rÒ  r–  r∆  )rm   rä   rù  rµ   r∂   r∑   rü  Z	dep_graphZdep_first_nodeZdep_last_noder   r   ro   rp   r∏      s*    
zRunnableLambda.get_graphr[  r‚   r¬   c                 C  sR   t |tÉrNt| dÉr*t|dÉr*| j|jkS t| dÉrJt|dÉrJ| j|jkS dS dS )Nrv  rè  F)rê   ré  rg   rv  rè  r»   ro   ro   rp   râ  Â  s    
zRunnableLambda.__eq__r`   c                 C  sñ   | j du rêt| dÉrBt| jtÉrBdt| jÉtdÉdÖ õ dù| _ nNt| dÉrfdt| jÉpZdõ dù| _ n*t| dÉrädt| jÉp~dõ dù| _ nd	| _ | j S )
z)A string representation of this Runnable.Nrv  zRunnableLambda(z	operator.rä  z...rè  zRunnableLambda(afunc=zRunnableLambda(...))	rí  rg   rê   rv  r   r`   ry   rD   rè  rÜ   ro   ro   rp   r  Ô  s    
"

ˇzRunnableLambda.__repr__r;   rO   r)   r<   ©rË   rÑ  rä   r‘   rc   c           	   	   K  s‹   t †| j°rhd }ttd| jÉ|||fi |§éD ]6}|d u r@|}q.z|| }W q. tyb   |}Y q.0 q.nt| j|||fi |§é}t|tÉr“|d }|dkr¥d| õ d|õ dù}t|ÉÇ|†	|t
||†° |d dç°}td	|ÉS )
N˙#Callable[[Input], Iterator[Output]]⁄recursion_limitr   ˙&Recursion limit reached when invoking ˙ with input ⁄.rÇ   ©rR  r¢  r<   )ré   rw  rv  r+   r   r{   rê   r\   ⁄RecursionErrorr‹   r2   r~  )	rm   rË   rÑ  rä   r‘   r>  rµ  r¢  r   ro   ro   rp   ⁄_invoke˛  sH    
¸˚

ˇˇ
ˇ˝˛zRunnableLambda._invokerN   ©r  rÑ  rä   r‘   rc   c              
   ã  s∫  t àdÉràj}nft†àj°r:ddddddúáfdd	Ñânddddddúáfd
d	ÑâtàÉddddúá áfddÑÉ}|}t|Éêr2d }ttdt	td|É|à |fi |§éÉÉ4 I d H öd}td|É2 z>3 d H W }	|d u r⁄|	}q¿z||	 }W q¿ t
y¸   |	}Y q¿0 q¿6 W d   ÉI d H  êqT1 I d H ês&0    Y  n"t	td|É|à |fi |§éI d H }t|tÉêr∞à d }
|
dkêrådàõ d|õ dù}t|ÉÇ|†|tà |†° |
d dç°I d H }td|ÉS )Nrè  r;   rN   r)   r   r<   r©  c              	     sh   d }t tdà jÉ| ||†° fi |§éD ]6}|d u r8|}q&z|| }W q& tyZ   |}Y q&0 q&td|ÉS )Nr°  r<   )r+   r   rv  ⁄get_syncr{   )r  rÑ  rä   r‘   r>  rµ  rÜ   ro   rp   rv  7  s     
¸˚
z%RunnableLambda._ainvoke.<locals>.funcc                   s   t à j| ||†° fi |§éS rÈ   ©r+   rv  r™  )r  rÑ  rä   r‘   rÜ   ro   rp   rv  P  s
    ˇˇ©rt   r‘   rc   c                  ü  s   t à àg| ¢R i |§éI d H S rÈ   ©r3   ©rt   r‘   ©rä   rv  ro   rp   ⁄fZ  s    z"RunnableLambda._ainvoke.<locals>.fzAsyncGenerator[Any, Any]r   r  r¢  r   r£  r§  r•  rÇ   r¶  )rg   rè  ré   rw  rv  r   rH   rI   r   r*   r{   rê   r\   rß  r›   r2   r~  )rm   r  rÑ  rä   r‘   rè  r∞  r>  r  rµ  r¢  r   ro   ©rä   rv  rm   rp   ⁄_ainvoke+  sl    


¸˚˛ˇ˛>ˇˇ
ˇ˝˛
zRunnableLambda._ainvoker„   rŸ   c                 K  s6   t | dÉr&| j| j|t|Éfi |§éS d}t|ÉÇdS )aa  Invoke this Runnable synchronously.

        Args:
            input: The input to this Runnable.
            config: The config to use. Defaults to None.
            kwargs: Additional keyword arguments.

        Returns:
            The output of this Runnable.

        Raises:
            TypeError: If the Runnable is a coroutine function.
        rv  zGCannot invoke a coroutine function synchronously.Use `ainvoke` instead.N)rg   rá  r®  r,   r{   rã  ro   ro   rp   r‹   è  s    
˝¸zRunnableLambda.invokec                 À  s"   | j | j|t|Éfi |§éI dH S )a  Invoke this Runnable asynchronously.

        Args:
            input: The input to this Runnable.
            config: The config to use. Defaults to None.
            kwargs: Additional keyword arguments.

        Returns:
            The output of this Runnable.
        N)rà  r≤  r,   r€   ro   ro   rp   r›   ≠  s    ˝¸zRunnableLambda.ainvoker8  r  )⁄chunksrÑ  rä   r‘   rc   c              	   k  sB  d}|D ]6}|s|}d}qz|| }W q t y<   |}Y q0 qt†| j°r®d }t| j|||fi |§éD ]<}	|	V  |d u rÄ|	}qhz||	 }W qh t y¢   |	}Y qh0 qhnt| j|||fi |§é}t|tÉêr$|d }
|
dkrˆd| õ d|õ dù}t|ÉÇ|†|t	||†
° |
d d	ç°D ]}	|	V  êqnt†| j°ês>td
|ÉV  d S )NFTr¢  r   r£  r§  r•  rÇ   r¶  r<   )r{   ré   rw  rv  r+   rê   r\   rß  r  r2   r~  r   )rm   r≥  rÑ  rä   r‘   r9  r:  r;  r>  rµ  r¢  r   ro   ro   rp   rJ  ≈  sZ    
ˇˇ

ˇˇˇ˝˛zRunnableLambda._transformc                 k  s>   t | dÉr.| j|| jt|Éfi |§éE d H  nd}t|ÉÇd S )Nrv  zGCannot stream a coroutine function synchronously.Use `astream` instead.)rg   r∂  rJ  r,   r{   rã  ro   ro   rp   r<    s    
˝¸ˇzRunnableLambda.transformc                 K  s   | j t|gÉ|fi |§éS rÈ   rM  r€   ro   ro   rp   r    s    zRunnableLambda.streamr=  r  c              	    s‹  d}|2 z>3 d H W }|s"|}d}qz|| }W q t yD   |}Y q0 q6 tàdÉr\àj}nVt†àj°rtd}	t |	ÉÇddddd	d
úáfddÑâtàÉddddúá áfddÑÉ}
|
}t|Éêr0d }tdt	td|É|à |fi |§éÉ2 zH3 d H W }|V  |d u êr|}q‚z|| }W q‚ t êy(   |}Y q‚0 q‚6 n"t	td|É|à |fi |§éI d H }t
|tÉêr¬à d }|dkêrädàõ d|õ dù}	t|	ÉÇ|†|tà |†° |d dç°2 z3 d H W }|V  êq®6 nt|Éêsÿtd	|ÉV  d S )NFTrè  zMCannot stream from a generator function asynchronously.Use .stream() instead.r;   rN   r)   r   r<   r†  c                   s   t à j| ||†° fi |§éS rÈ   r´  )rË   rÑ  rä   r‘   rÜ   ro   rp   rv  B  s
    ˇˇz(RunnableLambda._atransform.<locals>.funcr¨  c                  ü  s   t à àg| ¢R i |§éI d H S rÈ   r≠  rÆ  rØ  ro   rp   r∞  L  s    z%RunnableLambda._atransform.<locals>.fr  r   r¢  r   r£  r§  r•  rÇ   r¶  )r{   rg   rè  ré   rw  rv  r   rH   r   r*   rê   r\   rß  r  r2   r~  )rm   r≥  rÑ  rä   r‘   r9  r:  r;  rè  r   r∞  r>  rµ  r¢  ro   r±  rp   rK  !  sÄ    
ˇ

¸˚˛

¸˚	
ˇ˝˛
zRunnableLambda._atransformc                 K s6   | j || jt|Éfi |§é2 z3 d H W }|V  q6 d S rÈ   )rπ  rK  r,   )rm   r⁄   rä   r‘   r>  ro   ro   rp   r?  Ñ  s    ˝¸zRunnableLambda.atransformc                  sB   ddúá fddÑ}| j |É |fi |§é2 z3 d H W }|V  q(6 d S )Nr=  rs   c                    s
   à V  d S rÈ   ro   ro   rP  ro   rp   rQ  ö  s    z+RunnableLambda.astream.